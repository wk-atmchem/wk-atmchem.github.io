---
layout:     post
title:      WRF常见bug及解决方案
subtitle:   WRF常见bug及解决方案
date:       2021-6-3
author:     Kai Wu
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - models
---

# Summary of WRF bugs and solutions 
### [WRF Errors: WARNING: Field XXX has missing values]

When running metgrid.exe, I encountered the following error:

      'WARNING: Field PRES has missing values at level 200100 at (i,j)=(1,1)'
      'WARNING: Field PRES has missing values at level 200100 at (i,j)=(1,1)'
      'WARNING: Field PRESSURE has missing values at level 200100 at (i,j)=(1,1)'
      'WARNING: Field PMSL has missing values at level 200100 at (i,j)=(1,1)'
      'WARNING: Field PSFC has missing values at level 200100 at (i,j)=(1,1)'
      'WARNING: Field SOILHGT has missing values at level 200100 at (i,j)=(1,1)'
      'ERROR: Missing values encountered in interpolated fields. Stopping.'

The solution was so easy. In short, please check that your ungribbed data domain includes the domain which you are trying to extract with metgrid.  
解决方案：下载的再分析资料小于模型模拟设置的domain，下载更大范围的再分析资料即可.  
The error occurs when the intermediate files prepared by ungrib.exe (and, potentially, calc_ecmwf_p.exe) do not cover the full domain as defined in namelist.wps.  
This can happen, e.g., if the meteorological fields are not global. In my case, I had downloaded ECMWF data for central Europe only, and then later extended the model domain a bit. Once I re-downloaded the meteorological data, everything went smoothly.  

### [WRF Errors: WRF Errors: could not find trapping x locations]
When running real.exe, I encountered the following error:

      'troubles, could not find trapping x locations'

Apparently, the x in the error message could not find trapping x locations is referring to general x values in the interpolation subroutine lagrange_setup (so x is not related to longitude!). Looking for sfcprs3 in the source code file, one can find
      'Computes the surface pressure by vertically interpolating'
      'linearly (or log) in z the pressure, to the targeted topography.'  
解决方案：这个报错是由于缺失垂直层数据导致的，下载ERA5再分析资料的所有垂直层的资料即可.  
The solution was to download all 137 model levels by using LEVELIST=1/to/137 in the MARS request. When doing that, the lnsp is indeed contained in the model level Grib files.  


